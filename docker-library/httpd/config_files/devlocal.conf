<VirtualHost *:80>
        ServerAdmin devuser@example.com

        ServerName ${DEV_DOMAIN}
        ServerAlias *.${DEV_DOMAIN}

        Define DEFAULT_DOCUMENT_ROOT /var/www/
        PassEnv PHP_VERSION
        
        <IfModule mod_lua.c>
                DocumentRoot ${DEFAULT_DOCUMENT_ROOT}

                LuaHookTranslateName "/etc/apache2/lua/resolve_docroot.lua" silly_mapper
        </IfModule>

        <IfModule !mod_lua.c>
                DocumentRoot ${DEFAULT_DOCUMENT_ROOT}
        </IfModule>      


        <IfModule mod_dir.c>
                DirectoryIndex index.html index.cgi index.pl index.php index.xhtml index.htm
        </IfModule>

    
        SetEnvIf Host ".*--p83.*" PHP_VERSION=83
        SetEnvIf Host ".*--p84.*" PHP_VERSION=84

        # Websocket config
        RewriteCond %{HTTP:Upgrade} websocket [NC]
        RewriteCond %{HTTP:Connection} upgrade [NC]
        RewriteRule ^/?(.*) "ws://phpwebsocket:8080/$1" [P,L]

        <FilesMatch ".+\.php$">
                <If "reqenv('PHP_VERSION') -eq 83">
                        SetHandler "proxy:fcgi://php83dev:9000"
                </If>
                <If "reqenv('PHP_VERSION') -eq 84">
                        SetHandler "proxy:fcgi://php84dev:9000"
                </If>
        </FilesMatch>

        <Directory /home/devuser/public_html/>
                Options FollowSymLinks
                AllowOverride All
                Require all granted
        </Directory>

</VirtualHost>