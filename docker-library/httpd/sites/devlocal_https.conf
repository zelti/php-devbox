<VirtualHost *:443>
        ServerAdmin yostinv@gmail.com

        DocumentRoot /var/www
        ServerName dev.local
        ServerAlias *.dev.local

        SSLEngine ON
        SSLCertificateFile /etc/apache2/ssl.crt/devlocal.crt
        SSLCertificateKeyFile /etc/apache2/ssl.key/devlocal.key
        #SSLCertificateFile <ruta al servidor.pem>
        #SSLCertificateChainFile <ruta al servidor.pem>

        RewriteEngine On

        ## URLS WITH DOUBLE DASH AS SUBDIRECTORIES, AND PHP VERSION TO TRIGGER SPECIFIC VERSION
        # *--p[VERSION].dev.local

        # Level 4 : my--very--sub--url--p71.dev.local
        RewriteCond %{HTTP_HOST} ^([^\.]+)--([^\.]+)--([^\.]+)--([^\.]+)--p[0-9]{2}\.dev.local
        RewriteCond /home/devuser/public_html/%4/%3/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%4/%3/%2/%1/$1 [L]

        # Level 3 : very--sub--url--p71.dev.local
        RewriteCond %{HTTP_HOST} ^([^\.]+)--([^\.]+)--([^\.]+)--p[0-9]{2}\.dev.local
        RewriteCond /home/devuser/public_html/%3/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%3/%2/%1/$1 [L]

        # Level 2 : sub--url--p71.dev.local
        RewriteCond %{HTTP_HOST} ^([^\.]+)--([^\.]+)--p[0-9]{2}\.dev.local
        RewriteCond /home/devuser/public_html/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%2/%1/$1 [L]

        # Level 1 : url--p71.dev.local
        RewriteCond %{HTTP_HOST} ^([^\.]+)--p[0-9]{2}\.dev.local
        RewriteCond /home/devuser/public_html/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%1/$1 [L]

        # Root of public_html : p71.dev.local/dirname
        RewriteCond %{HTTP_HOST} ^p[0-9]{2}\.dev.local
        RewriteCond /home/devuser/public_html -d
        RewriteRule ^(.*) /home/devuser/public_html/$1 [L]


        ## URLS WITH DOUBLE DASH AS SUBDIRECTORIES 
        ## *.[TRIGRAMME].synodev.tech

        # Level 4 : my--very--sub--url.dev.local
        RewriteCond %{HTTP_HOST} ^([^\.]+)--([^\.]+)--([^\.]+)--([^\.]+)\.dev.local
        RewriteCond /home/devuser/public_html/%4/%3/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%4/%3/%2/%1/$1 [L]

        # Level 3 : very--sub--url.dev.local
        RewriteCond %{HTTP_HOST} ^([^\.]+)--([^\.]+)--([^\.]+)\.dev.local
        RewriteCond /home/devuser/public_html/%3/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%3/%2/%1/$1 [L]

        # Level 2 : sub--url.dev.local
        RewriteCond %{HTTP_HOST} ^([^\.]+)--([^\.]+)\.dev.local
        RewriteCond /home/devuser/public_html/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%2/%1/$1 [L]

        # Level 1 : url.dev.local
        RewriteCond %{HTTP_HOST} ^([^\.]+)\.dev.local
        RewriteCond /home/devuser/public_html/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%1/$1 [L]

        # Root of public_html : dev.local/dirname
        RewriteCond %{HTTP_HOST} ^([^\.]+)\.dev.local
        RewriteCond /home/devuser/public_html -d
        RewriteRule ^(.*) /home/devuser/public_html/$1 [L]


        ## URLS WITH DOUBLE DOTS AS SUBDIRECTORIES

        ## *.dev.local
        
        # Level 4 : my.very.sub.url.dev.local
        RewriteCond %{REQUEST_URI} !^/icons/
        RewriteCond %{HTTP_HOST} ^([^\.]+)\.([^\.]+)\.([^\.]+)\.([^\.]+)\.dev.local
        RewriteCond /home/devuser/public_html/%4/%3/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%4/%3/%2/%1/$1 [L]

        # Level 3 : very.sub.url.dev.local
        RewriteCond %{REQUEST_URI} !^/icons/
        RewriteCond %{HTTP_HOST} ^([^\.]+)\.([^\.]+)\.([^\.]+)\.dev.local
        RewriteCond /home/devuser/public_html/%3/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%3/%2/%1/$1 [L]

        # Level 2 : sub.url.dev.local
        RewriteCond %{REQUEST_URI} !^/icons/
        RewriteCond %{HTTP_HOST} ^([^\.]+)\.([^\.]+)\.dev.local
        RewriteCond /home/devuser/public_html/%2/%1 -d
        RewriteRule ^(.*) /home/devuser/public_html/%2/%1/$1 [L]        


        <IfModule mod_dir.c>
                DirectoryIndex index.html index.cgi index.pl index.php index.xhtml index.htm
        </IfModule>

    
        SetEnvIf Host ".*--p83.*" PHPVERSION=83
        SetEnvIf Host ".*--p84.*" PHPVERSION=84

        # Websocket config
        RewriteCond %{HTTP:Upgrade} websocket [NC]
        RewriteCond %{HTTP:Connection} upgrade [NC]
        RewriteRule ^/?(.*) "ws://phpwebsocket:8080/$1" [P,L]

        <FilesMatch ".+\.php$">
                <If "reqenv('PHPVERSION') -eq 83">
                        SetHandler "proxy:fcgi://extphp83dev:9001"
                </If>
                <If "reqenv('PHPVERSION') -eq 84">
                        SetHandler "proxy:fcgi://extphp84dev:9001"
                </If>
        </FilesMatch>

        <Directory /home/devuser/public_html/>
        Options FollowSymLinks
        AllowOverride All
        Require all granted
        </Directory>

</VirtualHost>